<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘ç€¨äº®ä»‹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¥åº·è¨ºæ–­</title>
    <style>
        /* --- åŸºæœ¬è¨­å®š --- */
        :root {
            --light-bg: #f5f5f7;
            --light-card-bg: #ffffff;
            --light-text: #1d1d1f;
            --light-text-sub: #86868b;
            --light-border: #e5e5e5;
            --dark-bg: #121212;
            --dark-card-bg: #1e1e1e;
            --dark-text: #e0e0e0;
            --dark-text-sub: #a0a0a0;
            --dark-border: #333333;
            --accent-green: #34c759;
            --accent-red: #ff3b30;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 2em;
            transition: background-color 0.5s, color 0.5s;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
        }

        /* --- ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ --- */
        body.light-mode {
            background-color: var(--light-bg);
            color: var(--light-text);
        }
        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        .container.light-mode { background-color: var(--light-card-bg); }
        .container.dark-mode { background-color: var(--dark-card-bg); }
        h1.light-mode, h2.light-mode { border-bottom-color: var(--light-border); }
        h1.dark-mode, h2.dark-mode { border-bottom-color: var(--dark-border); }
        .label.light-mode { color: var(--light-text); }
        .label.dark-mode { color: var(--dark-text); }
        .status span:not(.label).light-mode { color: var(--light-text-sub); }
        .status span:not(.label).dark-mode { color: var(--dark-text-sub); }

        /* --- ç”Ÿå­˜ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ --- */
        #liveness-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 10;
        }
        #liveness-message {
            font-size: clamp(2rem, 8vw, 5rem); /* å¯å¤‰ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
            font-weight: bold;
            padding: 0 1rem;
        }
        #liveness-subtext {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            margin-top: 1rem;
            color: var(--light-text-sub);
        }
        body.dark-mode #liveness-subtext {
            color: var(--dark-text-sub);
        }

        /* --- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: calc(100vh - 4em); /* paddingã‚’è€ƒæ…® */
            opacity: 1;
            transition: opacity 0.5s;
        }
        .main-content {
            display: flex;
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 800px;
        }

        /* --- PC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè¡¨ç¤º (æ¨ªé•·) --- */
        @media (min-aspect-ratio: 1/1) {
            .profile-container {
                flex: 0 0 40%;
                padding-right: 2em;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .profile-image {
                width: 100%;
                height: auto;
                aspect-ratio: 1 / 1;
                object-fit: cover;
                border-radius: 12px;
            }
            .details-container {
                flex: 1;
                overflow-y: auto;
            }
        }

        /* --- ã‚¹ãƒãƒ›è¡¨ç¤º (ç¸¦é•·) --- */
        @media (max-aspect-ratio: 1/1) {
            .profile-container {
                display: none; /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«éè¡¨ç¤º */
            }
            .details-container {
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
                height: 100%;
                overflow-y: auto;
            }
        }
        
        .container {
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1, h2 {
            border-bottom-width: 2px;
            border-bottom-style: solid;
            padding-bottom: 0.5em;
            white-space: nowrap;
        }
        .status { margin-bottom: 1.2em; font-size: 1.1em; }
        .label { font-weight: 600; display: inline-block; width: 120px; }

        /* --- å¿ƒé›»å›³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ --- */
        #ecg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

    </style>
</head>
<body class="light-mode">

    <div id="liveness-container">
        <div id="liveness-message"></div>
        <div id="liveness-subtext"></div>
    </div>
    
    <canvas id="ecg-canvas"></canvas>

    <div class="wrapper">
        <div class="main-content">
            <div class="profile-container">
                <img src="https://muraseryosuke.info/assets/img/ogp.jpg" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" class="profile-image">
                </div>

            <div class="details-container">
                <div class="container light-mode" id="details-card">
                    <h1 class="light-mode">æ‘ç€¨äº®ä»‹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¥åº·è¨ºæ–­</h1>
                    <div class="status">æœ€çµ‚æ›´æ–°: <span id="last_updated" class="light-mode">---</span></div>
                    
                    <h2 class="light-mode"><span class="label light-mode">â¤ï¸ ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢</span></h2>
                    <div class="status"><span class="label light-mode">å¿ƒæ‹æ•°:</span> <span id="heart_rate" class="light-mode">---</span> bpm</div>
                    <div class="status"><span class="label light-mode">æ­©æ•°:</span> <span id="steps" class="light-mode">---</span> æ­©</div>
                    <div class="status"><span class="label light-mode">ã‚«ãƒ­ãƒªãƒ¼:</span> <span id="calories" class="light-mode">---</span> kcal</div>
                    <div class="status"><span class="label light-mode">ğŸ©º ä½“èª¿:</span> <span id="condition" class="light-mode">---</span></div>
                    <div class="status"><span class="label light-mode">â˜€ï¸ èµ·åºŠæ™‚é–“:</span> <span id="wakeup_time" class="light-mode">---</span></div>

                    <h2 class="light-mode"><span class="label light-mode">ğŸ“ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span></h2>
                    <div class="status"><span class="label light-mode">ç¾åœ¨åœ°:</span> <span id="location" class="light-mode">---</span></div>
                    
                    <h2 class="light-mode"><span class="label light-mode">ğŸ“± ãƒ‡ãƒã‚¤ã‚¹</span></h2>
                    <div class="status"><span class="label light-mode">ãƒãƒƒãƒ†ãƒªãƒ¼:</span> <span id="device_status" class="light-mode">---</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gistId = '1f81b107b898201a865a613c319d579b'; 
        const gistFileName = 'murase_status.json';

        // --- å¿ƒé›»å›³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ---
        const canvas = document.getElementById('ecg-canvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        let x = 0;
        let y = height / 2;
        let heartRateBPM = 60; // åˆæœŸå€¤
        let lastBeatTime = 0;

        function drawEcg() {
            const beatInterval = 60000 / heartRateBPM;
            const now = Date.now();
            
            ctx.clearRect(x, 0, 10, height);
            ctx.beginPath();
            ctx.moveTo(x - 1, y);
            
            let newY = height / 2;
            // PQRSTæ³¢ã‚’ç°¡æ˜“çš„ã«è¡¨ç¾
            if (now - lastBeatTime > beatInterval) {
                lastBeatTime = now;
                newY = height / 2 - 50; // Ræ³¢
            } else if (now - lastBeatTime < 50) {
                newY = height / 2 + 10; // Sæ³¢
            } else if (now - lastBeatTime > beatInterval - 200) {
                 newY = height / 2 + 20; // Tæ³¢
            }

            y = y * 0.9 + newY * 0.1; // æ»‘ã‚‰ã‹ã«ç§»å‹•
            ctx.lineTo(x, y);
            ctx.strokeStyle = document.body.classList.contains('dark-mode') ? 'var(--accent-red)' : 'var(--accent-green)';
            ctx.lineWidth = 2;
            ctx.stroke();

            x++;
            if (x > width) {
                x = 0;
                ctx.clearRect(0,0,width,height);
            }
            requestAnimationFrame(drawEcg);
        }
        window.addEventListener('resize', () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            x = 0;
            y = height / 2;
        });
        drawEcg();
        // --- ã“ã“ã¾ã§å¿ƒé›»å›³ ---

        async function updateStatus() {
            try {
                const response = await fetch(`https://api.github.com/gists/${gistId}`);
                const gist = await response.json();
                if (!response.ok || !gist.files || !gist.files[gistFileName]) {
                    throw new Error('Gistã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                const content = JSON.parse(gist.files[gistFileName].content);

                const lastUpdated = new Date(content.last_updated);
                const diffHours = (new Date() - lastUpdated) / (1000 * 60 * 60);

                // --- ç”Ÿå­˜ç¢ºèªã¨ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ ---
                const livenessMessageEl = document.getElementById('liveness-message');
                const livenessSubtextEl = document.getElementById('liveness-subtext');
                const wrapperEl = document.querySelector('.wrapper');
                
                if (diffHours > 13) {
                    document.body.className = 'dark-mode';
                    livenessMessageEl.textContent = 'æ‘ç€¨äº®ä»‹ã‹ã‚‰ã®å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                    livenessSubtextEl.innerHTML = `æœ€çµ‚æ›´æ–°: ${lastUpdated.toLocaleString('ja-JP')} <br>å®‰å¦ç¢ºèªã¯ <a href="https://twitter.com/vl_lvo0" target="_blank">X(æ—§Twitter)@vl_lvo0</a> ã¸`;
                    document.getElementById('liveness-container').style.opacity = 1;
                    wrapperEl.style.opacity = 0;
                } else {
                    document.body.className = 'light-mode';
                    livenessMessageEl.textContent = 'æ‘ç€¨äº®ä»‹ã¯ç”Ÿãã¦ã„ã¾ã™ã€‚';
                    livenessSubtextEl.textContent = '';
                    document.getElementById('liveness-container').style.opacity = 1;
                    wrapperEl.style.opacity = 1;
                }
                document.querySelectorAll('.container, h1, h2, .label, .status span:not(.label)').forEach(el => {
                    el.className = document.body.className;
                });

                // --- ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ›´æ–° ---
                document.getElementById('last_updated').textContent = lastUpdated.toLocaleString('ja-JP', { dateStyle: 'medium', timeStyle: 'short' });
                
                const currentHeartRate = parseInt(content.health.heart_rate, 10);
                document.getElementById('heart_rate').textContent = currentHeartRate || 'N/A';
                if(currentHeartRate) heartRateBPM = currentHeartRate; // å¿ƒé›»å›³ã«åæ˜ 

                document.getElementById('steps').textContent = content.health.steps || 'N/A';
                document.getElementById('calories').textContent = content.health.active_calories ? Math.round(content.health.active_calories) : 'N/A';
                
                document.getElementById('location').textContent = content.location.city || 'N/A';
                
                const deviceStatus = `${content.device.battery}% ${content.device.is_charging === true ? 'âš¡ï¸ å……é›»ä¸­' : ''}`;
                document.getElementById('device_status').textContent = deviceStatus;
                
                if (content.health.wakeup_time) {
                    const wakeupDate = new Date(content.health.wakeup_time);
                    document.getElementById('wakeup_time').textContent = wakeupDate.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
                }

                const hrv = parseFloat(content.health.condition_hrv);
                const conditionEl = document.getElementById('condition');
                if (hrv > 40) {
                    conditionEl.textContent = 'è‰¯å¥½ âœ…';
                    conditionEl.style.color = 'green';
                } else if (hrv > 20) {
                    conditionEl.textContent = 'æ™®é€š ğŸ˜';
                    conditionEl.style.color = 'orange';
                } else if (hrv) {
                    conditionEl.textContent = 'è¦æ³¨æ„ âš ï¸';
                    conditionEl.style.color = 'red';
                } else {
                    conditionEl.textContent = 'N/A';
                }

            } catch (error) {
                console.error('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—:', error);
                const livenessMessageEl = document.getElementById('liveness-message');
                livenessMessageEl.textContent = 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
                document.getElementById('liveness-container').style.opacity = 1;
                document.querySelector('.wrapper').style.opacity = 0;
            }
        }

        updateStatus();
        setInterval(updateStatus, 60000); // 1åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–°
    </script>
</body>
</html>
